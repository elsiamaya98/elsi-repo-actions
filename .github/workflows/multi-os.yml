name: Tests Multi-OS

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-matrix:
    name: Test en ${{ matrix.os }} con Node ${{ matrix.node-version }}
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node-version: [16, 18, 20]

    steps:
      - name: üì• Checkout del c√≥digo
        uses: actions/checkout@v3
      
      - name: ‚öôÔ∏è Configurar Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
      
      - name: üì¶ Instalar dependencias
        run: npm install
      
      - name: üß™ Ejecutar tests
        run: npm test


      #############################################
      #       INFORMACI√ìN POR SISTEMA OPERATIVO   #
      #############################################

      # --- LINUX ---
      - name: üíª Informaci√≥n Linux
        if: runner.os == 'Linux'
        shell: bash
        run: |
          echo "===================================="
          echo "Sistema: ${{ matrix.os }}"
          echo "Node.js: ${{ matrix.node-version }}"
          echo "Runner OS: Linux"
          echo "===================================="
          echo "Ejecutando en Linux"
          uname -a
          echo "---"
          cat /etc/os-release
          echo "===================================="

      # --- WINDOWS ---
      - name: üíª Informaci√≥n Windows
        if: runner.os == 'Windows'
        shell: pwsh
        run: |
          Write-Host "===================================="
          Write-Host "Sistema: ${{ matrix.os }}"
          Write-Host "Node.js: ${{ matrix.node-version }}"
          Write-Host "Runner OS: Windows"
          Write-Host "===================================="
          Write-Host "Ejecutando en Windows"
          systeminfo | Select-String "OS"
          Write-Host "===================================="

      # --- MACOS ---
      - name: üíª Informaci√≥n macOS
        if: runner.os == 'macOS'
        shell: bash
        run: |
          echo "===================================="
          echo "Sistema: ${{ matrix.os }}"
          echo "Node.js: ${{ matrix.node-version }}"
          echo "Runner OS: macOS"
          echo "===================================="
          echo "Ejecutando en macOS"
          sw_vers
          echo "===================================="


  #############################################
  #        JOB ESPEC√çFICO DE LINUX            #
  #############################################

  linux-specific:
    name: üêß Operaciones espec√≠ficas de Linux
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3
      
      - name: üêß Comandos espec√≠ficos de Linux
        run: |
          echo "Estos comandos solo funcionan en Linux:"
          echo "===================================="
          echo "Distribuci√≥n:"
          cat /etc/os-release
          echo "===================================="
          echo "Kernel:"
          uname -r
          echo "===================================="
          echo "CPU Info:"
          lscpu | grep "Model name"
          echo "===================================="
          echo "Memoria:"
          free -h
          echo "===================================="
          echo "Procesos del sistema:"
          ps aux | head -n 10


  #############################################
  #         JOB ESPEC√çFICO DE WINDOWS         #
  #############################################

  windows-specific:
    name: ü™ü Operaciones espec√≠ficas de Windows
    runs-on: windows-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3
      
      - name: ü™ü Comandos espec√≠ficos de Windows
        shell: pwsh
        run: |
          Write-Host "Estos comandos solo funcionan en Windows:"
          Write-Host "===================================="
          Write-Host "Informaci√≥n del Sistema:"
          Get-ComputerInfo | Select-Object CsName, WindowsVersion, OsArchitecture
          Write-Host "===================================="
          Write-Host "Procesos en ejecuci√≥n:"
          Get-Process | Select-Object -First 10 Name, CPU, Id
          Write-Host "===================================="


  #############################################
  #              RESUMEN FINAL                #
  #############################################

  summary:
    name: üìä Resumen de Ejecuci√≥n
    needs: [test-matrix, linux-specific, windows-specific]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: üìä Generar resumen
        run: |
          echo "===================================="
          echo "RESUMEN DE EJECUCI√ìN MULTI-OS"
          echo "===================================="
          echo "‚úÖ Todos los jobs completados (incluso si fall√≥ alguno)"
          echo "Tests ejecutados en:"
          echo "  - Ubuntu (Linux)"
          echo "  - Windows"
          echo "  - macOS"
          echo "Con Node.js versiones: 16, 18, 20"
          echo "===================================="
          echo "Total de combinaciones ejecutadas: 9"
          echo "===================================="
